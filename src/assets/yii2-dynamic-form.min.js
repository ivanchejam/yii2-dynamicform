/**
 * yii2-dynamic-form
 *
 * A jQuery plugin to clone form elements in a nested manner, maintaining accessibility.
 *
 * @author Wanderson Bragan√ßa <wanderson.wbc@gmail.com>
 */
!function($){$.fn.yiiDynamicForm=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?($.error("Method "+e+" does not exist on jQuery.yiiDynamicForm"),!1):methods.init.apply(this,arguments)};var events={beforeClone:"beforeClone",afterClone:"afterClone",limitReached:"limitReached"},defaults={limit:999,cloneContainer:".clone-container",cloneButton:".clone",deleteButton:".delete",clonePosition:"after",cloneFromTemplate:!1},config,regex=/(.*-)(\d)(-.*)/i,methods={init:function(e){return this.each(function(){var n=$(this);n.data("yiiDynamicForm")||(config=$.extend({},defaults,e||{}),n.find(config.cloneButton).length&&n.on("click",config.cloneButton,function(e){e.preventDefault(),n.triggerHandler(events.beforeClone,[$(this)]),startClone(e,$(this),n),n.find(config.deleteButton).length&&n.on("click",config.deleteButton,function(e){e.preventDefault(),removeItem(n,$(this))})}))})},updateContainer:function(){var e=$(this);redoIDs(e),restoreSpecialJs(e)}},startClone=function(e,n,t){var i=t.find(config.cloneContainer).length;i<config.limit?($toclone=config.cloneFromTemplate!==!1?$($(config.cloneFromTemplate).html()):$(config.cloneContainer).first(),$newclone=$toclone.clone(!1,!1),"after"!=config.clonePosition?$(config.cloneContainer).firt().before($newclone):$(config.cloneContainer).last().after($newclone),redoIDs(t),removeErrorCssClass($newclone),restoreSpecialJs(t),t.triggerHandler(events.afterClone,$newclone)):t.triggerHandler(events.limitReached,config.limit)},removeItem=function(e,n){var t=e.find(config.cloneContainer).length;t>1&&($todelete=n.closest(config.cloneContainer),$todelete.remove(),redoIDs(e),restoreSpecialJs(e))},removeErrorCssClass=function(e){e.find(".has-success").each(function(){$(this).removeClass("has-success")}),e.find(".has-error").each(function(){$(this).removeClass("has-error")})},restoreSpecialJs=function($container){var $hasDatepicker=$(config.cloneContainer).find("[data-plugin-name=datepicker]");$hasDatepicker.length>0&&$hasDatepicker.each(function(){$(this).parent().removeData().datepicker("remove"),$(this).parent().datepicker($(this).attr("data-plugin-options"))});var $hasMaskmoney=$(config.cloneContainer).find("[data-plugin-name=maskMoney]");$hasMaskmoney.length>0&&$hasMaskmoney.each(function(){$(this).parent().find("input").removeData().off();var id="#"+$(this).attr("id"),displayID=id+"-disp";$(displayID).maskMoney("destroy"),$(displayID).maskMoney(eval($(this).attr("data-plugin-options"))),$(displayID).maskMoney("mask",parseFloat($(displayID).val())),$(displayID).on("change",function(){var e=$(displayID).maskMoney("unmasked")[0];$(id).val(e),$(id).trigger("change")})});var $hasFileinput=$(config.cloneContainer).find("[data-plugin-name=fileinput]");$hasFileinput.length>0&&$hasFileinput.each(function(){$(this).fileinput(eval($(this).attr("data-plugin-options")))});var $hasTouchSpin=$(config.cloneContainer).find("[data-plugin-name=TouchSpin]");$hasTouchSpin.length>0&&$hasTouchSpin.each(function(){$(this).TouchSpin("destroy"),$(this).TouchSpin(eval($(this).attr("data-plugin-options")))})},redoIDs=function(e){e.find(config.cloneContainer).each(function(e){var n=e,t=$(this);$(this).find("*").each(function(){var i=$(this).attr("id");if(i){var o=i,a=i.match(regex);a&&4===a.length?(o=a[1]+e+a[3],$(this).attr("id",o)):(o=i+e,$(this).attr("id",o)),i!==o&&t.find(".field-"+i).each(function(){$(this).removeClass("field-"+i).addClass("field-"+o)})}var r=$(this).attr("for");if(r){var a=r.match(regex);a&&4===a.length?$(this).attr("for",a[1]+e+a[3]):$(this).attr("for",r+e)}var s=$(this).attr("name");if(s){var c=s.match(/\[([^}]+)\]/);if(c&&c.length>=1){var l=s;s=[].map.call(l,function(e,t){return isNaN(+e)||"["!==l[t-1]||"]"!==l[t+1]?e:n}).join(""),$(this).attr("name",s)}}})})}}(window.jQuery);
